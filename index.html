<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Experiments by sergejey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Experiments</h1>
      <h2 class="project-tagline">general experiments</h2>
      <a href="https://github.com/sergejey/experiments" class="btn">View on GitHub</a>
      <a href="https://github.com/sergejey/experiments/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/sergejey/experiments/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
<a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Welcome to GitHub Pages.</h3>

<h2>Дополненная реальность</h2>

      <p>Суть эксперимента -- вывести картинку с элементами дополненной реальности поверх потока с камеры электронного устройства (телефона, планшета). Но не просто вывести что-то в том месте, где находится маркер, а позиционировать камеру в виртуальной сцене нужным образом.</p>
      <p>Для решения задачи используется маркер (реальный и виртуальный). Реальный маркер представляет собой распечатанный <a href="http://jeromeetienne.github.io/threex.webar/marker/image-marker-265.html" target="_blank">символ</a>,
        который располагается в определённой точке физического пространства (в реальности). Виртуальный же маркер представляет собой
      объект, расположенный в определённом месте виртуальной сцены.</p>
      <p><b>Шаг 1.</b> Через камеру мобильного устройства мы получаем картинку и с помощью библиотеки <a href="https://github.com/jeromeetienne/threex.webar">threex</a>
      определяем координаты и положение маркера в системе координат "КАМЕРА ТЕЛЕФОНА - РЕАЛЬНЫЙ МАРКЕР"</p>
      <p><b>Шаг 2.</b> Находим координаты и положение виртуального маркера в системе координат виртуальной сцены и на основе полученной на шаге 1 информации,
      позиционируем виртуальную камеру так, чтобы проекции на экран обоих маркеров (реального и виртуального) совпадали.</p>
      <p><b>Сделано:</b>
        Страница, которая загружает виртуальную сцену; скрипт получает координаты реального маркера; скрипт находит маркер в виртуальной сцене.
      </p>
      <p><b>Необходимо:</b>
        Написать алгоритм позиционирования виртуальной камеры.
      </p>
      <p>
        Данные <b>реального</b> маркера в системе координат камеры телефона:
      <ul>
        <li>вектор позиции (X,Y,Z)</li>
        <li>вектор поворота (rotation.X,Y,Z)</li>
        <li>вектор размера (scale.X,Y,Z -- всегда фиксированный = 35)</li>
      </ul>
      </p><p>
        Данные <b>виртуального</b> маркера в системе координат виртуальной сцены:
      <ul>
        <li>вектор позиции (X,Y,Z)</li>
        <li>вектор quaternion (X,Y,Z)</li>
        <li>размер (для простоты задан так же 35, но может быть любой)</li>
      </ul>
      </p>
      <p>Проще всего начать разбираться с <a href="./ar/index1.html#image">базового примера</a>, на котором мы пытаемся совместить реальный и виртуальный маркер</p>
      <p>
        Код, отвечающий за преобразование:
<pre>
// MAKING CALCULAION
// Находим маркер в виртуальной сцене
var marker_object = scene.getObjectByName( "Marker"+marker.id, true );

// Раскладываем информацию о виртуальном маркере на вектора
var virtual_position = new THREE.Vector3();
var virtual_quaternion = new THREE.Quaternion();
var virtual_scale = new THREE.Vector3();
marker_object.matrixWorld.decompose( virtual_position, virtual_quaternion, virtual_scale );

// Находим маркер в реальности по картинке (записываем информацию в realObject)
// в реальности функция выглядит вот <a href="http://c2n.me/3Dvailq.png">так</a>
jsArucoMarker.markerToObject3D(marker, realObject);

// Находим коофициент масштаба для разных систем координат
var markerWidth=(marker_object.geometry.parameters.width);
var k=markerWidth/realObject.scale.x;

//пытаемся позиционировать камеру :)
camera.position.x=virtual_position.x-(realObject.position.x*k);
camera.position.y=virtual_position.y-(realObject.position.y*k);
camera.position.z=virtual_position.z-(realObject.position.z*k);
    </pre>
      </p>

<h3>AR Test 1</h3>
      <p>
        <a href="./ar/index1.html#camera">AR camera</a><br/>
        <a href="./ar/index1.html#image">AR image</a><br/>
        <a href="./ar/index1.html#video">AR video</a><br/>
      </p>

<h3>AR Test 2</h3>
<p>
  <a href="./ar/index.html#camera">AR camera</a><br/>
  <a href="./ar/index.html#image">AR image</a><br/>
  <a href="./ar/index.html#video">AR video</a><br/>
</p>

        <h3>AR Test 3</h3>
        <p>
            <a href="./ar/index3.html#camera">AR camera</a><br/>
            <a href="./ar/index3.html#image">AR image</a><br/>
            <a href="./ar/index3.html#video">AR video</a><br/>
        </p>

      <p>  [ <a href="http://jeromeetienne.github.io/threex.webar/marker/image-marker-265.html" target="_blank">Marker image</a> ]
        [ <a href="./ar/image.jpg" target="_blank">Test image</a> ]
        [ <a href="./ar/test.mp4" target="_blank">Test video</a> ]
        <br/>
        <a href="https://github.com/jeromeetienne/threex.webar">Source project</a><br/>
        <img src="http://api.qrserver.com/v1/create-qr-code/?color=000000&amp;bgcolor=FFFFFF&amp;data=https%3A%2F%2Fsergejey.github.io%2Fexperiments%2Far%2Findex.html&amp;qzone=1&amp;margin=0&amp;size=400x400&amp;ecc=L" alt="qr code" />
      </p>


      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/sergejey/experiments">Experiments</a> is maintained by <a href="https://github.com/sergejey">sergejey</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
